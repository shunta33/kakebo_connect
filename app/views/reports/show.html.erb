<h2><%= @user.name %>さんの<%= @month %>月レポート</h2>

<%= form_with url: report_path(params[:id]), local:true, method: :get do |f| %>
  <%= f.select :month, Expense.pluck(:date).map{|d|["#{d.year}/#{d.month}","#{d.year}/#{d.month}"]}.uniq %>
  <%= f.submit "へ移動" %>
<% end %>

<% @expenses_sum = 0 %>
<% @expenses.each do |expense| %>
  <% @expenses_sum += expense.expenses_amount %>
<% end %>

<table>
  <tr>
    <th>カテゴリー</th>
    <th>支出額</th>
  </tr>
  <% ExpenseCategory.all.each do |category| %>
  <tr>
    <td>
    <%= category.category_name %>
    </td>
    <td>
    <%= @expenses
     .where(expenses_category_id: category).pluck(:expenses_amount).sum %>
    </td>
  </tr>
   <% end %>
  <tr>
    <th>合計支出額</th>
    <th><%= @expenses_sum %></th>
  </tr>
</table>

<% @incomes_sum = 0 %>
<% @incomes.each do |income| %>
    <% @incomes_sum += income.incomes_amount %>
<% end %>
</table>


<table>
  <tr>
    <th>カテゴリー</th>
    <th>収入支出額</th>
  </tr>
  <% IncomeCategory.all.each do |category| %>
  <tr>
    <td>
    <%= category.category_name %>
    </td>
    <td>
    <%= @incomes
     .where(incomes_category_id: category).pluck(:incomes_amount).sum %>
    </td>
  </tr>
   <% end %>
  <tr>
    <th>合計収入額</th>
    <th><%= @incomes_sum %></th>
  </tr>
</table>

